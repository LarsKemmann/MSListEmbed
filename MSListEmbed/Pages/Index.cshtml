@page
@model IndexModel
@{
    ViewData["Title"] = "Listing";

    var urgentUnmetItems = Model.ListItems.Where(i => i.Status == "URGENT Needs").ToList();
    var unmetItems = Model.ListItems.Where(i => i.Status == "Unmet Needs").ToList();
    var metItems = Model.ListItems.Where(i => i.Status == "Needs Already Met").ToList();
    var otherItems = Model.ListItems
    .Where(i => i.Status != "URGENT Needs" && i.Status != "Unmet Needs" && i.Status != "Needs Already Met")
    .ToList();
}

@if (Model.ListItems.Any())
{
    if (urgentUnmetItems.Any())
    {
        <h2>‼ URGENT Needs</h2>
        <ul>
            @foreach (var item in urgentUnmetItems)
            {
                <li>
                    <strong>@item.Title</strong><br />
                    <span style="whitespace: pre">@Html.Raw(item.Description)</span>
                    <button onclick="location.href='mailto:@Model.EmailTo?subject=URGENT Need: @item.Title'">
                        I/we can help
                    </button>
                </li>
            }
        </ul>
    }

    if (unmetItems.Any())
    {
        <h2>Unmet Needs</h2>
        <ul>
            @foreach (var item in unmetItems)
            {
                <li>
                    <strong>@item.Title</strong><br />
                    <span style="whitespace: pre">@Html.Raw(item.Description)</span>
                    <button onclick="location.href='mailto:@Model.EmailTo?subject=Need: @item.Title'">
                        I/we can help
                    </button>
                </li>
            }
        </ul>
    }

    if (metItems.Any())
    {
        <h2>Needs Already Met</h2>
        <ul>
            @foreach (var item in metItems)
            {
                <li>
                    <strong>@item.Title</strong><br />
                    <span style="whitespace: pre">@Html.Raw(item.Description)</span>
                </li>
            }
        </ul>
    }

    if (otherItems.Any())
    {
        <h2>Other</h2>
        <ul>
            @foreach (var item in otherItems)
            {
                <li>
                    <strong>@item.Title</strong><br />
                    <em>Status: @item.Status</em><br />
                    <span style="whitespace: pre">@Html.Raw(item.Description)</span>
                </li>
            }
        </ul>
    }
}
else
{
    <p>No items found.</p>
}
